NSString & Unicode

è®¡ç®—æœºæ²¡æ³•ç›´æŽ¥å¤„ç†æ–‡æœ¬ï¼Œå®ƒåªå’Œæ•°å­—æ‰“äº¤é“ã€‚
ä¸ºäº†åœ¨è®¡ç®—æœºé‡Œç”¨æ•°å­—è¡¨ç¤ºæ–‡æœ¬ï¼Œæˆ‘ä»¬æŒ‡å®šäº†ä¸€ä¸ªä»Žå­—ç¬¦åˆ°æ•°å­—çš„æ˜ å°„ã€‚è¿™ä¸ªæ˜ å°„å°±å«åšç¼–ç ï¼ˆencodingï¼‰ã€‚

ASCII ç æ˜¯ 7 ä½çš„ï¼Œå®ƒå°†è‹±æ–‡å­—æ¯ï¼Œæ•°å­— 0-9 ä»¥åŠä¸€äº›æ ‡ç‚¹ç¬¦å·å’ŒæŽ§åˆ¶å­—ç¬¦æ˜ å°„ä¸º 0-127 è¿™äº›æ•´åž‹

Unicode æ ‡å‡†ä¸ºä¸–ç•Œä¸Šå‡ ä¹Žæ‰€æœ‰çš„ä¹¦å†™ç³»ç»Ÿé‡Œæ‰€ä½¿ç”¨çš„æ¯ä¸€ä¸ªå­—ç¬¦æˆ–ç¬¦å·å®šä¹‰äº†ä¸€ä¸ªå”¯ä¸€çš„æ•°å­—ã€‚
è¿™ä¸ªæ•°å­—å«åšç ç‚¹ï¼ˆcode pointsï¼‰ï¼Œä»¥ U+xxxx è¿™æ ·çš„æ ¼å¼å†™æˆï¼Œæ ¼å¼é‡Œçš„ xxxx ä»£è¡¨å››åˆ°å…­ä¸ªåå…­è¿›åˆ¶çš„æ•°ã€‚
æ¯”å¦‚ï¼ŒU+0041ï¼ˆåè¿›åˆ¶æ˜¯ 65ï¼‰è¿™ä¸ªç ç‚¹ä»£è¡¨æ‹‰ä¸å­—æ¯è¡¨ï¼ˆå’Œ ASCII ä¸€è‡´ï¼‰é‡Œçš„å­—æ¯ Aï¼›
U+1F61B ä»£è¡¨åä¸ºâ€œä¼¸å‡ºèˆŒå¤´çš„è„¸â€çš„ emoji

Unicode ç¼–ç æ‰©å±•åˆ°äº† 21 ä½ï¼ˆä»Ž U+0000 åˆ° U+10FFFFï¼‰ å®ƒæ˜¯21ä½çš„  è¿™21ä½æä¾›äº† 1,114,112 ä¸ªç ç‚¹


ç»„åˆå­—ç¬¦åºåˆ—:
æœ‰é‡éŸ³ç¬¦å·çš„å­—æ¯ Ã© å¯ä»¥ç›´æŽ¥è¡¨ç¤ºæˆ U+00E9ï¼ˆã€Œæœ‰å°–éŸ³ç¬¦å·çš„å°å†™æ‹‰ä¸å­—æ¯ eã€ï¼‰ï¼Œæˆ–è€…ä¹Ÿå¯ä»¥è¡¨ç¤ºæˆç”± U+0065ï¼ˆã€Œå°å†™æ‹‰ä¸å­—æ¯ eã€ï¼‰å†åŠ  U+0301ï¼ˆã€Œå°–éŸ³ç¬¦å·ã€ï¼‰ç»„æˆçš„åˆ†è§£å½¢å¼
åœ¨ Unicode çš„è¯­å¢ƒä¸‹ï¼Œä¸¤ç§å½¢å¼å¹¶ä¸ç›¸ç­‰ï¼ˆå› ä¸ºä¸¤ç§å½¢å¼åŒ…å«ä¸åŒçš„ç ç‚¹ï¼‰ï¼Œä½†æ˜¯ç¬¦åˆæ ‡å‡†ç­‰ä»·ï¼ˆcanonically equivalentï¼‰ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå®ƒä»¬æœ‰ç€ç›¸åŒçš„å¤–è§‚å’Œæ„ä¹‰ã€‚

Unicode æ ‡å‡†ä¸ºæ­¤å®šä¹‰äº†å‡ ç§æ˜ å°„ï¼Œå«åšã€ŒUnicode è½¬æ¢æ ¼å¼ã€ï¼ˆUnicode Transformation Formatsï¼ŒUTFï¼‰
å¦‚æžœæ˜¯ç”¨ UTF ç¼–ç çš„ï¼Œé‚£ä¹ˆå°±è¦ä½¿ç”¨ Unicode

æœ€æ¸…æ¥šæ˜Žäº†çš„ä¸€ä¸ª UTF å°±æ˜¯ UTF-32ï¼šå®ƒåœ¨æ¯ä¸ªç ç‚¹ä¸Šä½¿ç”¨æ•´ 32 ä½ã€‚32 å¤§äºŽ 21ï¼Œå› æ­¤æ¯ä¸€ä¸ª UTF-32 å€¼éƒ½å¯ä»¥ç›´æŽ¥è¡¨ç¤ºå¯¹åº”çš„ç ç‚¹ã€‚å°½ç®¡ç®€å•ï¼ŒUTF-32å´å‡ ä¹Žä»Žæ¥ä¸åœ¨å®žé™…ä¸­ä½¿ç”¨ï¼Œå› ä¸ºæ¯ä¸ªå­—ç¬¦å ç”¨ 4 å­—èŠ‚å¤ªæµªè´¹ç©ºé—´äº†

UTF-16 ä»¥åŠã€Œä»£ç†å¯¹ã€ï¼ˆSurrogate Pairsï¼‰çš„æ¦‚å¿µ:
NSString å¯¹ Unicode çš„å®žçŽ°æ¯æ¯ç›¸å…³ã€‚å®ƒæ˜¯æ ¹æ®æœ‰ 16 ä½å›ºå®šé•¿åº¦çš„ã€Œç å…ƒã€ï¼ˆcode unitsï¼‰å®šä¹‰çš„
UTF-16 æœ¬èº«æ˜¯ä¸€ç§é•¿åº¦å¯å˜çš„ç¼–ç ã€‚åŸºæœ¬å¤šæ–‡ç§å¹³é¢ï¼ˆBMPï¼‰ä¸­çš„æ¯ä¸€ä¸ªç ç‚¹éƒ½ç›´æŽ¥ä¸Žä¸€ä¸ªç å…ƒç›¸æ˜ å°„ã€‚é‰´äºŽ BMP å‡ ä¹Žå›Šæ‹¬äº†æ‰€æœ‰å¸¸è§å­—ç¬¦ï¼ŒUTF-16 ä¸€èˆ¬åªéœ€è¦ UTF-32 ä¸€åŠçš„ç©ºé—´ã€‚å…¶å®ƒå¹³é¢é‡Œå¾ˆå°‘ä½¿ç”¨çš„ç ç‚¹éƒ½æ˜¯ç”¨ä¸¤ä¸ª 16 ä½çš„ç å…ƒæ¥ç¼–ç çš„ï¼Œè¿™ä¸¤ä¸ªåˆèµ·æ¥è¡¨ç¤ºä¸€ä¸ªç ç‚¹çš„ç å…ƒå°±å«åšã€Œä»£ç†å¯¹ã€ã€‚
UTF-16 ä¸‹ï¼ŒU+10FFFF æ˜¯èƒ½ç¼–ç çš„æœ€é«˜å€¼
å’Œæ‰€æœ‰å¤šå­—èŠ‚é•¿åº¦çš„ç¼–ç ç³»ç»Ÿä¸€æ ·ï¼ŒUTF-16ï¼ˆä»¥åŠ UTF-32ï¼‰è¿˜å¾—è§£å†³å­—èŠ‚é¡ºåºçš„é—®é¢˜ã€‚åœ¨å†…å­˜é‡Œå­˜å‚¨å­—ç¬¦ä¸²æ—¶ï¼Œå¤§å¤šæ•°å®žçŽ°æ–¹å¼è‡ªç„¶éƒ½é‡‡ç”¨è‡ªå·±è¿è¡Œå¹³å°çš„ CPU çš„å­—èŠ‚åºï¼ˆendiannessï¼‰ï¼›è€Œåœ¨ç¡¬ç›˜é‡Œå­˜å‚¨æˆ–è€…é€šè¿‡ç½‘ç»œä¼ è¾“å­—ç¬¦ä¸²æ—¶ï¼ŒUTF-16 å…è®¸åœ¨å­—ç¬¦ä¸²çš„å¼€å¤´æ’å…¥ä¸€ä¸ªã€Œå­—èŠ‚é¡ºåºæ ‡è®°ã€ï¼ˆByte Order Maskï¼ŒBOMï¼‰ã€‚å­—èŠ‚é¡ºåºæ ‡è®°æ˜¯ä¸€ä¸ªå€¼ä¸º U+FEFF çš„ç å…ƒï¼Œé€šè¿‡æ£€æŸ¥æ–‡ä»¶çš„å¤´ä¸¤ä¸ªå­—èŠ‚ï¼Œè§£ç å™¨å°±å¯ä»¥è¯†åˆ«å‡ºå…¶å­—èŠ‚é¡ºåºã€‚å­—èŠ‚é¡ºåºæ ‡è®°ä¸æ˜¯å¿…é¡»çš„ï¼ŒUnicode æ ‡å‡†æŠŠé«˜å­—èŠ‚é¡ºåºï¼ˆbig-endian byte orderï¼‰å®šä¸ºé»˜è®¤æƒ…å†µã€‚UTF-16 éœ€è¦æŒ‡æ˜Žå­—èŠ‚é¡ºåºï¼Œè¿™ä¹Ÿæ˜¯ä¸ºä»€ä¹ˆ UTF-16 åœ¨æ–‡ä»¶æ ¼å¼å’Œç½‘ç»œä¼ è¾“æ–¹é¢ä¸å—æ¬¢è¿Žçš„ä¸€ä¸ªåŽŸå› ï¼Œä¸è¿‡å¾®è½¯å’Œè‹¹æžœéƒ½åœ¨è‡ªå·±çš„æ“ä½œç³»ç»Ÿå†…éƒ¨ä½¿ç”¨å®ƒ

ç¼–ç ç©ºé—´è¢«åˆ†æˆ 17 ä¸ªå¹³é¢ï¼Œæ¯ä¸ªå¹³é¢æœ‰ 65,536 ä¸ªå­—ç¬¦ã€‚0 å·å¹³é¢å«åšã€ŒåŸºæœ¬å¤šæ–‡ç§å¹³é¢ã€ï¼ˆBasic Multilingual Plane, BMPï¼‰ï¼Œæ¶µç›–äº†å‡ ä¹Žæ‰€æœ‰ä½ èƒ½é‡åˆ°çš„å­—ç¬¦ï¼Œé™¤äº† emojiã€‚å…¶å®ƒå¹³é¢å«åšè¡¥å……å¹³é¢ï¼Œå¤§å¤šæ˜¯ç©ºçš„


===================
ä¸€ä¸ªå­—ç¬¦ä¸²å¯¹è±¡ä»£è¡¨ç€ä¸€ä¸ª Unicode å­—ç¬¦ç»„æˆçš„æ•°ç»„

typedef unsigned short unichar;

NSString å¯¹è±¡ä»£è¡¨çš„å…¶å®žæ˜¯ç”¨ UTF-16 ç¼–ç çš„ç å…ƒç»„æˆçš„æ•°ç»„ã€‚ç›¸åº”åœ°ï¼Œlengthæ–¹æ³•çš„è¿”å›žå€¼ä¹Ÿæ˜¯å­—ç¬¦ä¸²åŒ…å«çš„ç å…ƒä¸ªæ•°ï¼ˆè€Œä¸æ˜¯å­—ç¬¦ä¸ªæ•°ï¼‰###
NSString ä»£è¡¨çš„æ˜¯ç”¨ UTF-16 ç¼–ç çš„æ–‡æœ¬ï¼Œé•¿åº¦ã€ç´¢å¼•å’ŒèŒƒå›´éƒ½åŸºäºŽ UTF-16 çš„ç å…ƒ#####
æ¯å½“æ–‡æ¡£æåŠã€Œå­—ç¬¦ã€ï¼ˆcharacterï¼‰æˆ–è€… unichar æ—¶ï¼Œå®ƒå…¶å®žéƒ½è¯´çš„æ˜¯ç å…ƒ

åªè¦ä½ ç¡®ä¿ Xcode ä»¥ UTF-8 ç¼–ç ä¿å­˜æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥ç›´æŽ¥ç”¨ Character View æ’å…¥ä»»æ„å­—ç¬¦

ðŸ˜„
çœ¯ç€çœ¼ç›éœ²é½¿è€Œç¬‘
Unicode: U+1F604ï¼ŒUTF-8: F0 9F 98 84


ç»„åˆå­—ç¬¦åºåˆ—ï¼šå¦‚æžœå­—æ¯ Ã© æ˜¯ä»¥åˆ†è§£å½¢å¼ç¼–ç çš„ï¼Œç®—ä½œä¸¤ä¸ªç å…ƒï¼š
NSString *s = @"e\u0301"; // e + Â´
NSLog(@"The length of %@ is %lu", s, [s length]);
è¿™ä¸ªå­—ç¬¦ä¸²åŒ…å«äº†ä¸¤ä¸ª Unicode å­—ç¬¦


å­—ç¬¦ä¸²å¯èƒ½ä¼šåŒ…å«ç»„åˆå­—ç¬¦åºåˆ—ã€ä»£ç†å¯¹æˆ–å˜ä½“åºåˆ—ã€‚è‹¹æžœæŠŠè¿™äº›éƒ½å«åšåˆæˆå­—ç¬¦åºåˆ—ï¼ˆcomposed character sequenceï¼‰
æ³¨æ„ä¸è¦æŠŠåˆæˆå­—ç¬¦åºåˆ—ï¼ˆè‹¹æžœçš„æœ¯è¯­ï¼‰å’Œç»„åˆå­—ç¬¦åºåˆ—ï¼ˆUnicode æœ¯è¯­ï¼‰æžæ··ã€‚åŽè€…æ˜¯å‰è€…çš„å­é›†

å¯ä»¥ç”¨rangeOfComposedCharacterSequenceAtIndex:
æ¥ç¡®å®šç‰¹å®šä½ç½®çš„ unichar æ˜¯ä¸æ˜¯ä»£è¡¨å•ä¸ªå­—ç¬¦ï¼ˆå¯èƒ½ç”±å¤šä¸ªç ç‚¹ç»„æˆï¼‰çš„ç å…ƒåºåˆ—çš„ä¸€éƒ¨åˆ†


NSString æœ‰æ›´å¥½åœ°æ–¹å¼ï¼š
enumerateSubstringsInRange:options:usingBlock: æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•æŠŠ Unicode æŠ½è±¡çš„åœ°æ–¹éšè—äº†ï¼Œèƒ½è®©ä½ è½»æ¾åœ°å¾ªçŽ¯å­—ç¬¦ä¸²é‡Œçš„ç»„åˆå­—ç¬¦ä¸²ã€å•è¯ã€è¡Œã€å¥å­æˆ–æ®µè½ã€‚ä½ ç”šè‡³å¯ä»¥åŠ ä¸Š NSStringEnumerationLocalized è¿™ä¸ªé€‰é¡¹ï¼Œè¿™æ ·å¯ä»¥åœ¨ç¡®å®šè¯è¯­é—´å’Œå¥å­é—´çš„è¾¹ç•Œæ—¶æŠŠç”¨æˆ·æ‰€åœ¨çš„åŒºåŸŸè€ƒè™‘è¿›åŽ»ã€‚è¦éåŽ†å•ä¸ªå­—ç¬¦ï¼ŒæŠŠå‚æ•°æŒ‡å®šä¸º
NSStringEnumerationByComposedCharacterSequences


isEqual: å’Œ isEqualToString: è¿™ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯ä¸€ä¸ªå­—èŠ‚ä¸€ä¸ªå­—èŠ‚åœ°æ¯”è¾ƒçš„ã€‚å¦‚æžœå¸Œæœ›å­—ç¬¦ä¸²çš„åˆæˆå’Œåˆ†è§£çš„å½¢å¼ç›¸å»åˆï¼Œå¾—å…ˆè‡ªå·±æ­£è§„åŒ–ï¼š
NSString *s = @"\u00E9"; // Ã©
NSString *t = @"e\u0301"; // e + Â´
BOOL isEqual = [s isEqualToString:t];
NSLog(@"%@ is %@ to %@", s, isEqual ? @"equal" : @"not equal", t);
// => Ã© is not equal to Ã©

// Normalizing to form C
NSString *sNorm = [s precomposedStringWithCanonicalMapping];
NSString *tNorm = [t precomposedStringWithCanonicalMapping];
BOOL isEqualNorm = [sNorm isEqualToString:tNorm];
NSLog(@"%@ is %@ to %@", sNorm, isEqualNorm ? @"equal" : @"not equal", tNorm);
// => Ã© is equal to Ã©


NSString *s = @"ff"; // ff
NSString *t = @"\uFB00"; // ï¬€ ligature
NSComparisonResult result = [s localizedCompare:t];
NSLog(@"%@ is %@ to %@", s, result == NSOrderedSame ? @"equal" : @"not equal", t);
// => ff is equal to ï¬€