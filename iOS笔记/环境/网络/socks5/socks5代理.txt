https://medium.com/@nimit95/socks-5-a-proxy-protocol-b741d3bec66c
SOCKS 5 â€” A Proxy Protocol

Socks å®ƒåˆ†socks 4å’Œsocks 5ä¸¤ç§ç±»å‹ï¼Œsocks 4åªæ”¯æŒTCPåè®®è€Œsocks 5æ”¯æŒTCP/UDPåè®®ï¼Œè¿˜æ”¯æŒå„ç§èº«ä»½éªŒè¯æœºåˆ¶ç­‰åè®®ã€‚å…¶æ ‡å‡†ç«¯å£ä¸º1080ã€‚

socks5 æ˜¯ä¸€ä¸ªå¸¸ç”¨çš„ä»£ç†åè®®, å®ƒæ—¢å¯ä»¥ç”¨æ¥ä»£ç† TCP, ä¹Ÿå¯ä»¥ä»£ç† UDP
è®¸å¤šç½‘ç»œè½¯ä»¶éƒ½æ”¯æŒ socks5, ä¸»æµæ“ä½œç³»ç»Ÿä¹Ÿæ”¯æŒä½¿ç”¨ socks5 ä½œç³»ç»Ÿä»£ç†
https://datatracker.ietf.org/doc/html/rfc1928


how to make a Simple HTTP/HTTPS proxy in node
https://medium.com/@nimit95/a-simple-http-https-proxy-in-node-js-4eb0444f38fc


SOCKS 5 basically is a Framework for a General Proxy Protocol. // SOCKS 5 æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªé€šç”¨ä»£ç†åè®®æ¡†æ¶ã€‚

What I mean by a general proxy protocol is that for each application layer protocol like HTTP, HTTPS(controversial), FTP and many more, 
you would need to set up a different proxy server. 
For example, for HTTP you would have something like squid, 
for HTTPS Browsermob proxy and so on so forth. 
Now a SOCKS 5 proxy provides a general framework for these protocols to transparently and securely traverse the data.


#####
// SOCKS çš„å¦ä¸€ä¸ªç”¨é€”æ˜¯ä½œä¸ºç»•è¿‡å·¥å…·ï¼Œå…è®¸æµé‡ç»•è¿‡äº’è”ç½‘è¿‡æ»¤ï¼Œè®¿é—®åŸæœ¬è¢«å±è”½çš„å†…å®¹ï¼Œä¾‹å¦‚è¢«æ”¿åºœã€å·¥ä½œåœºæ‰€ã€å­¦æ ¡å’Œç‰¹å®šå›½å®¶/åœ°åŒºçš„ç½‘ç»œæœåŠ¡å±è”½çš„å†…å®¹ã€‚
Another use of SOCKS is as a circumvention tool, 
allowing traffic to bypass Internet filtering to access content otherwise blocked, 
e.g., by governments, workplaces, schools, and country-specific web service

// æ­¤å¤–ï¼ŒSOCKS 5 è¿˜æä¾›èº«ä»½éªŒè¯ï¼Œç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·æ‰èƒ½è®¿é—®æœåŠ¡å™¨ã€‚
SOCKS 5 additionally provides authentication so only authorized users may access a server.
#####



Real-World Application:
1. Mostly all torrent clients have an option to configure a SOCKS 5 proxy to bypass the firewall if any.
2. It is faster than VPN, so in many places where the speed matter it is used over VPN.
3. The Tor onion proxy software presents a SOCKS interface to its clients. // https://en.wikipedia.org/wiki/Tor_(network)


Tor ï¼ˆä¹Ÿç§°ä¸º â€œThe Onion Routerâ€ï¼‰:
Tor æ˜¯ä¸€ä¸ªå¼€æ”¾æºä»£ç çš„è½¯ä»¶ + ç½‘ç»œç³»ç»Ÿï¼Œæ—¨åœ¨æä¾›åŒ¿åé€šä¿¡æœåŠ¡ã€‚
å®ƒæ‰€ä¾èµ–çš„æŠ€æœ¯è¢«ç§°ä½œâ€œæ´‹è‘±è·¯ç”±â€ï¼ˆonion routingï¼‰ï¼Œå› ä¸ºæ•°æ®åƒæ´‹è‘±ä¸€æ ·è¢«åŒ…äº†å¥½å‡ å±‚â€œåŠ å¯†å±‚â€ã€‚
å®ƒæ˜¯åšä»€ä¹ˆçš„ï¼åŸç†æ˜¯ä»€ä¹ˆ:
(1)å½“ä½ ä½¿ç”¨ Tor æ—¶ï¼Œæµé‡ä¸ä¼šç›´æ¥ä»ä½ çš„è®¾å¤‡å‘å¾€ç›®æ ‡ç½‘ç«™ï¼Œè€Œæ˜¯ç»è¿‡éšæœºé€‰æ‹©çš„å¤šä¸ªâ€œä¸­ç»§èŠ‚ç‚¹â€ï¼ˆentryï¼ˆå…¥å£ï¼‰â†’ middleï¼ˆä¸­é—´ï¼‰â†’ exitï¼ˆå‡ºå£ï¼‰ï¼‰è½¬å‘ã€‚
(2)åœ¨æ¯ä¸€è·³ï¼Œä¸­ç»§åªèƒ½çŸ¥é“è‡ªå·±å‰é¢æ˜¯è°ã€åé¢æ˜¯è°ï¼Œè€Œä¸èƒ½åŒæ—¶çŸ¥é“â€œè¯·æ±‚æœ€åˆæ¥è‡ªè°â€å’Œâ€œæœ€ç»ˆåˆ°è¾¾äº†å“ªå„¿â€ã€‚è¿™ç§ç»“æ„å¢å¼ºäº†åŒ¿åæ€§ã€‚
(3)æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­è¢«å¤šå±‚åŠ å¯† â€”â€” ç±»ä¼¼äºå°†é€šè®¯â€œåŒ…è£¹â€åœ¨å¤šé‡ä¿¡å°ä¸­ï¼Œç„¶åé€å±‚æ‰“å¼€ã€‚
(4)å®ƒé™¤äº†ç”¨äºæµè§ˆæ™®é€šç½‘ç«™å¤–ï¼Œè¿˜æ”¯æŒæ‰€è°“çš„ â€œæ´‹è‘±æœåŠ¡â€ï¼ˆonion servicesï¼éšè—æœåŠ¡ï¼‰ï¼Œå³æœåŠ¡å™¨ä¹ŸéšåŒ¿å…¶ä½ç½®ï¼Œä»…é€šè¿‡ .onion åœ°å€è®¿é—®ã€‚
æœ‰ä»€ä¹ˆç”¨é€”:
å¯¹æŠ—ç›‘æ§å’Œè¿½è¸ªï¼šä½ å¯èƒ½ä¸å¸Œæœ› ISPã€æ”¿åºœã€å¹¿å‘Šå•†ã€é»‘å®¢ç­‰çŸ¥é“ä½ åœ¨ä¸Šä»€ä¹ˆç½‘ç«™ã€ä»å“ªå„¿æ¥çš„ã€‚Tor æä¾›äº†ä¸€å±‚ä¿æŠ¤ã€‚
è·¨è¶Šå®¡æŸ¥ä¸è®¿é—®å—é™å†…å®¹ï¼šåœ¨ä¸€äº›ç½‘ç»œå—é™åˆ¶çš„å›½å®¶/åœ°åŒºï¼ŒTor å¯ä»¥å¸®åŠ©â€œç¿»å¢™â€æˆ–è®¿é—®è¢«å±è”½çš„ç½‘ç«™ã€‚
ä¿æŠ¤æ•æ„Ÿèº«ä»½çš„ç”¨æˆ·ï¼šè®°è€…ã€å‘Šå¯†è€…ã€ç»´æƒäººå£«ã€ç”Ÿæ´»åœ¨ä¸“åˆ¶æ”¿æƒä¸‹çš„äººï¼Œå¯èƒ½å› ä¸ºå®‰å…¨/åŒ¿åéœ€æ±‚è€Œä½¿ç”¨ã€‚
æä¾›éšè—æœåŠ¡ï¼šæœåŠ¡å™¨ç«¯ä¹Ÿå¯ä»¥åˆ©ç”¨ Tor æ¥éšè—å…¶çœŸå® IP åœ°å€ä¸ä½ç½®ï¼Œä»è€Œå¢å¼ºæŠ—å®¡æŸ¥èƒ½åŠ›ã€‚



Basic Working:
#####
A wishes to communicate to B over the internet, but a firewall exists between those two, so A cannot connect to B directly.
So, A connects to a SOCKS 5 proxy, informing it to connect to B. The proxy sets up a connection to B on Aâ€™s behalf sending the confirmation back.
Now A can send whatever he wishes to send to B. 
#####


The SOCKS5 protocol is defined in RFC 1928.
https://datatracker.ietf.org/doc/html/rfc1928

Handshake:
æ ¹æ® SOCKS 5 HANDSHAKE å›¾ç‰‡:
[NOTE: 5, 1, 0 are actual bytes (0x05, 0x01, 0x00)]

1.
A(Client) sends the initiation packet(0x05, 0x01, 0x00) to the SOCKS5 proxy. 
The breakdown of the first packet is :
(1)The First Byte 0x05 is for the version of the SOCKS, in this case, it is SOCKS 5. 
This remains common for all the SOCKS 5 packets. 
(2)The Second Byte 0x01 is for authentication purposes. 
Precisely, the number of authentication methods supported by the client. 
Here 0x01 means one method is supported.
(3)The Third Byte 0x00 is for the authentication methods. 
There are authentication methods, variable length, 1 byte per method supported. 
The authentication methods supported are numbered as follows:
0x00: No authentication
0x01: GSSAPI
0x02: Username/password
0x03â€“0x7F: methods assigned by IANA
0x80â€“0xFE: methods reserved for private use

ä¾‹å­ï¼š
| å­—èŠ‚   | å€¼                       | å«ä¹‰ |
| ---- | ----------------------- | -- |
| 0x05 | SOCKS ç‰ˆæœ¬ 5              |    |
| 0x01 | æœ‰ 1 ä¸ªè®¤è¯æ–¹æ³•ï¼ˆNMETHODS = 1ï¼‰ |    |
| 0x00 | è¿™ 1 ä¸ªè®¤è¯æ–¹æ³•çš„å†…å®¹æ˜¯ â€œæ— éœ€è®¤è¯â€    |    |

| å­—èŠ‚   | å«ä¹‰           |
| ---- | ------------ |
| 0x05 | SOCKS5       |
| 0x02 | æ”¯æŒ 2 ç§è®¤è¯æ–¹å¼   |
| 0x00 | ç¬¬ä¸€ç§ï¼šæ— è®¤è¯      |
| 0x02 | ç¬¬äºŒç§ï¼šç”¨æˆ·å/å¯†ç è®¤è¯ |


2.
SOCKS Proxy sends back to A(0x05, 0x00). :

The Second Byte 0x00 is the chosen authentication method by the proxy. 
In this case, it was the only method provided by the client hence this. 
The subsequent authentication is method-dependent. 
Username and password authentication(method 0x02) is described in RFC 1929. 
Here no authentication dependent steps need to take place further. 
If the negotiated method includes encapsulation for purposes of integrity checking and/or confidentiality, 
further requests MUST be encapsulated in the method-dependent encapsulation.
https://datatracker.ietf.org/doc/html/rfc1929


3.
A(Client) sends the request packet (0x05, 0x01, 0x00, 0x03, <B_HOST>, <B_PORT>). 
Once the method-dependent subnegotiation has completed, the client sends the request details to SOCKS proxy:
(2)
The Second Byte 0x01 is for the command code. It is one byte
0x01: establish a TCP/IP stream connection
0x02: establish a TCP/IP port binding
0x03: associate a UDP port
(3)
The Third Byte 0x00 is a reserved byte. It must be 0x00 and 1 byte.
(4)
The Fourth Byte 0x03 is the address type of desired HOST and 1 byte. The options are as below.
0x01: IPv4 address, followed by 4 bytes IP
0x03: Domain name, 1 byte for name length, followed by host name
0x04: IPv6 address, followed by 16 bytes IP
(6)
The last Byte is port number in a network byte order, 2 bytes
https://en.wikipedia.org/wiki/Endianness#Networking


4.
SOCKS proxy sends back the request packet (0x05, 0x00, 0x00, 0x01, <B_HOST>, <B_PORT>). 
This is for the status of the request by the client to the proxy:
(2)
The Second Byte 0x00 is the status field. It is one byte. Meaning the request was granted.
(3)
The Third Byte 0x00 is a reserved byte. It must be 0x00 and 1 byte.
(4)
The Fourth Byte 0x01 is the address type of desired HOST and 1 byte. 
In case of CONNECT, this is followed by the binded IP address for the desired HOST, 
to give the client the detail of the DNS resolution.
(6)
The last Byte is port number in a network byte order, 2 bytes


After this, the connection takes place all the coming data from client A is transferred to client B and vice versa. 
This way the SOCKS proxy works as a general framework proxy and handle most PROTOCOL with its security features.


There is a great node library which can handle all the details for a socks server. 
It transforms the incoming SOCKS5 stream into its respective protocol stream.
https://www.npmjs.com/package/socks5-stream


==================================================Socks5 åŸºäº TCP å®¢æˆ·ç«¯çš„è¿‡ç¨‹
#####RFC 1928: SOCKS åè®®ç¬¬ 5 ç‰ˆ
https://luyuhuang.tech/2020/08/27/rfc1928.html
#####

å½“ä¸€ä¸ªåŸºäº TCP çš„å®¢æˆ·ç«¯æƒ³è¦ä¸ä¸€ä¸ªå¿…é¡»ç»ç”±é˜²ç«å¢™æ‰èƒ½è¿æ¥ (å–å†³äºå®ç°) çš„å¯¹è±¡å»ºç«‹è¿æ¥æ—¶, å®ƒå¿…é¡»åœ¨é€‚å½“çš„ç«¯å£å¼€å¯ä¸€æ¡åˆ° SOCKS æœåŠ¡å™¨ç³»ç»Ÿçš„ TCP è¿æ¥.
SOCKS æœåŠ¡é€šå¸¸ä½¿ç”¨ TCP çš„ 1080 ç«¯å£.å¦‚æœè¿æ¥è¯·æ±‚æˆåŠŸ, å®¢æˆ·ç«¯ä¼šè¿›å…¥åå•†é˜¶æ®µä»¥åå•†è®¤è¯æ–¹æ³•, ç„¶åä½¿ç”¨æ‰€é€‰çš„æ–¹æ³•è¿›è¡Œè®¤è¯, æ¥ç€å‘é€ç›¸åº”çš„è¯·æ±‚.
SOCKS æœåŠ¡å™¨ä¼šè¯„ä¼°è¯·æ±‚, ç„¶åå»ºç«‹é€‚å½“çš„è¿æ¥æˆ–æ‹’ç»å®ƒ.

å½“ç”¨åˆ° â€œVariableâ€ ä¸€è¯æ—¶, è¡¨ç¤ºå¯¹åº”å­—æ®µçš„é•¿åº¦æ˜¯ç”±ç›¸åº”çš„é•¿åº¦å­—æ®µ (ä¸€åˆ°ä¸¤å­—èŠ‚) æˆ–æ•°æ®ç±»å‹å­—æ®µæ‰€å®šä¹‰çš„å¯å˜é•¿åº¦.


å®¢æˆ·ç«¯è¿æ¥æœåŠ¡å™¨, ç„¶åå‘é€ä¸€æ¡åŒ…å«ç‰ˆæœ¬å·å’Œæ–¹æ³•é€‰æ‹©çš„æ¶ˆæ¯:
VER	NMETHODS	METHODS
1	1	1 è‡³ 255
VER å­—æ®µåœ¨è¿™ä¸ªç‰ˆæœ¬ç½®ä¸º X'05'. NMETHODS å­—æ®µåŒ…å«å‡ºç°åœ¨ METHODS å­—æ®µä¸­çš„æ–¹æ³•æ ‡è¯†ç¬¦çš„å­—èŠ‚æ•°.
æœåŠ¡å™¨ä» METHODS å­—æ®µä¸­ç»™å‡ºçš„æ–¹æ³•ä¸­é€‰æ‹©ä¸€ä¸ª, å°†å…¶æ”¾åœ¨è¿”å›ç»™å®¢æˆ·ç«¯æ¶ˆæ¯çš„ METHOD å­—æ®µä¸­:
VER	METHOD
1	1
å¦‚æœ METHOD å­—æ®µæ ‡è¯†é€‰æ‹©çš„æ–¹æ³•ä¸º X'FF', åˆ™å®¢æˆ·ç«¯åˆ—å‡ºçš„æ–¹æ³•å‡ä¸è¢«æœåŠ¡å™¨æ¥å—, æ­¤æ—¶å®¢æˆ·ç«¯å¿…é¡»å…³é—­è¿æ¥.
ç›®å‰å·²å®šä¹‰çš„æ–¹æ³•æœ‰:
X'00' æ— éœ€è®¤è¯
X'01' GSSAPI
X'02' ç”¨æˆ·å/å¯†ç 
X'03' è‡³ X'7F' ç”± IANA åˆ†é…
X'80' è‡³ X'FE' ä¿ç•™çš„ç§æœ‰æ–¹æ³•
X'FF' æ²¡æœ‰å¯æ¥å—çš„æ–¹æ³•

ç„¶åå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šè¿›å…¥è®¤è¯æ–¹æ³•æ‰€è§„å®šçš„å­åå•†è¿‡ç¨‹(sub-negotiation).
ä¾èµ–äºå…·ä½“æ–¹æ³•çš„å­åå•†è¿‡ç¨‹çš„æè¿°å¯ä»¥åœ¨å…¶å®ƒå¯¹åº”çš„æ–‡æ¡£ä¸­æ‰¾åˆ°.


è¯·æ±‚:
ä¸€æ—¦ä¾èµ–äºå…·ä½“æ–¹æ³•çš„å­åå•†è¿‡ç¨‹å®Œæˆ, å®¢æˆ·ç«¯å°±å¼€å§‹å‘é€è¯·æ±‚è¯¦æƒ….
å¦‚æœå‡ºäºå®Œæ•´æ€§æ£€æŸ¥æˆ–æœºå¯†æ€§çš„ç›®çš„, åå•†çš„æ–¹æ³•åŒ…æ‹¬å°è£…, åˆ™è¿™äº›è¯·æ±‚å¿…é¡»æŒ‰ç…§è¯¥æ–¹æ³•æ‰€å®šä¹‰çš„æ–¹å¼è¿›è¡Œå°è£….

SOCKS5 åœ¨å»ºç«‹è¿æ¥æ—¶ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¼šå…ˆè¿›è¡Œä¸€ä¸ªâ€œæ–¹æ³•åå•†â€ï¼ˆmethod negotiationï¼‰é˜¶æ®µã€‚
ä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯å‘Šè¯‰æœåŠ¡å™¨è‡ªå·±æ”¯æŒå“ªäº›è®¤è¯æˆ–å®‰å…¨æœºåˆ¶ï¼Œç„¶åæœåŠ¡å™¨é€‰æ‹©å…¶ä¸­ä¸€ç§ã€‚
æ‰€è°“â€œå°è£…ï¼ˆencapsulationï¼‰â€æŒ‡ä»€ä¹ˆï¼Ÿ
æŸäº›è®¤è¯æ–¹æ³•ï¼ˆMethodï¼‰ä¸ä»…ä»…æ˜¯â€œéªŒè¯èº«ä»½â€ï¼Œ#####å®ƒè¿˜ä¼šå¯¹åç»­ä¼ è¾“çš„æ•°æ®è¿›è¡ŒåŠ å¯†æˆ–ç­¾åã€‚#####
#####è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¯´â€œè¯¥æ–¹æ³•åŒ…å«äº†å°è£…ï¼ˆencapsulationï¼‰â€ã€‚#####
æ¯”å¦‚ï¼š
æŸç§ SOCKS5 æ–¹æ³•å¯èƒ½å®šä¹‰ï¼šéªŒè¯èº«ä»½åï¼Œåç»­çš„è¯·æ±‚å’Œæ•°æ®å¿…é¡»é€šè¿‡æŸç§å®‰å…¨é€šé“ï¼ˆæ¯”å¦‚ TLS æˆ–å…¶ä»–è‡ªå®šä¹‰åŠ å¯†å±‚ï¼‰å‘é€ï¼›
è¿™ç§â€œå¯¹è¯·æ±‚è¿›è¡Œé¢å¤–åŒ…è£¹æˆ–åŠ å¯†â€çš„è¡Œä¸ºï¼Œå°±å« encapsulationã€‚
#####
å½“ä½ ä½¿ç”¨çš„è®¤è¯æ–¹æ³•ï¼ˆMethodï¼‰æœ¬èº«è§„å®šäº†è¦å¯¹ SOCKS è¯·æ±‚æˆ–æ•°æ®åšåŠ å¯†/ç­¾å/å°è£…æ—¶ï¼Œä½ å¿…é¡»ç…§å®ƒçš„è§„èŒƒå»åšã€‚

æ¢å¥è¯è¯´ï¼š
å¦‚æœä½ é€‰çš„è®¤è¯æ–¹æ³•åªè´Ÿè´£èº«ä»½éªŒè¯ï¼ˆä¾‹å¦‚ç”¨æˆ·åå¯†ç è®¤è¯ï¼‰ï¼Œé‚£ä¹‹åçš„æ•°æ®ä»æ˜¯æ˜æ–‡çš„ï¼›
å¦‚æœä½ é€‰çš„è®¤è¯æ–¹æ³•è¦æ±‚â€œåç»­é€šä¿¡é€šè¿‡åŠ å¯†å°è£…â€ï¼Œé‚£æ‰€æœ‰çš„ SOCKS è¯·æ±‚ï¼ˆCONNECTã€BINDã€UDP ASSOCIATEï¼‰å’Œæ•°æ®éƒ½è¦åœ¨åŠ å¯†å±‚ä¸­å‘é€ã€‚

å‡è®¾æœªæ¥æœ‰ä¸€ä¸ªæ–¹æ³•å· 0x80ï¼ˆè‡ªå®šä¹‰ï¼‰ï¼Œä»£è¡¨ â€œä½¿ç”¨ TLS åŠ å¯†é€šé“â€ã€‚
å®¢æˆ·ç«¯å‘å‡ºï¼š
05 01 80
æœåŠ¡å™¨å›å¤ï¼š
05 80

ä»è¿™ä¹‹åï¼š
å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ä¹‹é—´è¦å»ºç«‹ TLSï¼›
æ‰€æœ‰åç»­ SOCKS è¯·æ±‚ï¼ˆä¾‹å¦‚ CONNECT å‘½ä»¤ï¼‰å¿…é¡»åœ¨è¿™ä¸ª TLS éš§é“é‡Œè¿›è¡Œï¼›
ä¸èƒ½å†å‘é€æ˜æ–‡çš„ SOCKS è¯·æ±‚åŒ…ã€‚

è¿™å°±æ˜¯â€œå¿…é¡»æŒ‰ç…§è¯¥æ–¹æ³•æ‰€å®šä¹‰çš„å°è£…æ–¹å¼è¿›è¡Œå°è£…â€ã€‚

â€œå°è£…â€æŒ‡çš„ä¸æ˜¯æ”¹å˜ SOCKS5 åè®®çš„å­—æ®µç»“æ„ï¼Œè€Œæ˜¯æŠŠ æ•´ä¸ª SOCKS5 è¯·æ±‚åŒ… å½“ä½œä¸€æ®µâ€œè´Ÿè½½æ•°æ®ï¼ˆpayloadï¼‰â€ï¼Œ
å†ç”¨åå•†å‡ºæ¥çš„åŠ å¯†ç®—æ³• æ•´ä½“åŠ å¯†/ç­¾åã€‚
æ˜æ–‡ SOCKS è¯·æ±‚ï¼š
[SOCKS header + address + port]
å°è£…åè¯·æ±‚ï¼š
[ENC( [SOCKS header + address + port] )]
æœåŠ¡å™¨æ”¶åˆ°åå…ˆè§£å¯†ï¼Œç„¶åå†è§£æ SOCKS å¤´

RFC 1928 æœ¬èº«å¹¶æ²¡æœ‰å®šä¹‰åŠ å¯†æœºåˆ¶ï¼Œå®ƒåªæ˜¯ä¸ºâ€œMethod æ‰©å±•â€ç•™ä¸‹äº†æ¥å£ã€‚
æŸäº›æ‰©å±•ï¼ˆä¾‹å¦‚ GSS-APIã€TLS-over-SOCKSï¼‰ä¼šå®šä¹‰è‡ªå·±çš„ã€Œå°è£…æ–¹å¼ã€ã€‚
è¿™äº›æ‰©å±•è¦æ±‚ï¼š
â€œæ‰€æœ‰çš„åç»­ SOCKS è¯·æ±‚/æ•°æ®éƒ½å¿…é¡»åœ¨è¯¥åŠ å¯†é€šé“é‡Œä¼ è¾“ã€‚â€
ä¹Ÿå°±æ˜¯è¯´:
ä¸æ˜¯æ¯ä¸ª SOCKS5 éƒ½ä¼šåŠ å¯†ï¼Œ
ä½†å¦‚æœåå•†çš„æ–¹æ³•è¦æ±‚å°è£…ï¼ˆä¾‹å¦‚ TLSã€GSS-APIï¼‰ï¼Œé‚£å°±è¦å¯¹æ•´ä¸ªè¯·æ±‚åŒ…åŠ å¯†ã€‚
#####


SOCKS è¯·æ±‚çš„æ ¼å¼å¦‚ä¸‹
VER	CMD	RSV	ATYP	DST.ADDR	DST.PORT
1	1	X'00'	1	Variable	2
å…¶ä¸­:
VER åè®®ç‰ˆæœ¬ X'05'
CMD å‘½ä»¤:
   CONNECT: X'01'
   BIND: X'02'
   UDP ASSOCIATE: X'03'
RSV ä¿ç•™
ATYP éšåçš„åœ°å€ç±»å‹
   IPv4 åœ°å€: X'01'
   åŸŸå: X'03'
   IPv6 åœ°å€: X'04'
DST.ADDR ç›®æ ‡åœ°å€
DST.PORT ç›®æ ‡ç«¯å£, ç½‘ç»œå­—èŠ‚åº
SOCKS æœåŠ¡å™¨é€šå¸¸ä¼šæ ¹æ®æºåœ°å€å’Œç›®æ ‡åœ°å€æ¥è¯„ä¼°è¯·æ±‚, ç„¶åæ ¹æ®è¯·æ±‚ç±»å‹é€‚å½“åœ°è¿”å›ä¸€ä¸ªæˆ–å¤šä¸ªåº”ç­”æ¶ˆæ¯.


åœ°å€:
å¯¹äºåœ°å€å­—æ®µ (DST.ADDR, BND.ADDR), ç”± ATYP å­—æ®µæŒ‡å®šå…¶åŒ…å«çš„åœ°å€ç±»å‹:
X'01'
IPv4 åœ°å€, é•¿åº¦ä¸º 4 å­—èŠ‚
X'03'
å®Œæ•´çš„åŸŸå, åœ°å€å­—æ®µçš„ç¬¬ä¸€ä¸ªå­—èŠ‚åŒ…å«çš„æ•°å­—è¡¨ç¤ºæ¥ä¸‹æ¥åŸŸåçš„é•¿åº¦ (å­—èŠ‚æ•°), ä¸åŒ…å«ç»“å°¾çš„ NUL å­—èŠ‚.
X'04'
IPv4 åœ°å€, é•¿åº¦ä¸º 16 å­—èŠ‚


åº”ç­”:
å®¢æˆ·ç«¯ä¸ SOCKS æœåŠ¡å™¨å»ºç«‹è¿æ¥å¹¶å®Œæˆèº«ä»½éªŒè¯åå•†å, å®¢æˆ·ç«¯å°±ä¼šå¼€å§‹å‘é€ SOCKS è¯·æ±‚ä¿¡æ¯. æœåŠ¡å™¨ä¼šè¯„ä¼°è¯·æ±‚, å¹¶è¿”å›å¦‚ä¸‹æ ¼å¼çš„åº”ç­”æ¶ˆæ¯:
VER	REP	RSV	ATYP	BND.ADDR	BND.PORT
1	1	X'00'	1	Variable	2

å…¶ä¸­:
VER åè®®ç‰ˆæœ¬ X'05'
REP åº”ç­”å­—æ®µ:
   X'00' æˆåŠŸ
   X'01' å¸¸è§„ SOCKS æœåŠ¡å™¨æ•…éšœ
   X'02' è§„åˆ™ä¸å…è®¸çš„é“¾æ¥
   X'03' ç½‘ç»œæ— æ³•è®¿é—®
   X'04' ä¸»æœºæ— æ³•è®¿é—®
   X'05' è¿æ¥è¢«æ‹’ç»
   X'06' TTL è¿‡æœŸ
   X'07' ä¸æ”¯æŒçš„å‘½ä»¤
   X'08' ä¸æ”¯æŒçš„åœ°å€ç±»å‹
   X'09' è‡³ X'FF' æœªåˆ†é…
RSV ä¿ç•™
ATYP éšåçš„åœ°å€ç±»å‹
   IPv4 åœ°å€: X'01'
   åŸŸå: X'03'
   IPv6 åœ°å€: X'04'
BND.ADDR æœåŠ¡å™¨ç»‘å®šåœ°å€
BND.PORT æœåŠ¡å™¨ç»‘å®šç«¯å£, ç½‘ç»œå­—èŠ‚åº

æ ‡è®°ä¸º â€œä¿ç•™â€ çš„å­—æ®µå¿…é¡»ç½®ä¸º X'00'
å¦‚æœåå•†çš„æ–¹æ³•å‡ºäºå®Œæ•´æ€§æˆ–æœºå¯†æ€§çš„ç›®çš„, åŒ…å«å°è£…, åˆ™åº”ç­”éœ€æŒ‰ç…§è¯¥æ–¹æ³•æ‰€å®šä¹‰çš„æ–¹å¼è¿›è¡Œå°è£….


CONNECT è¯·æ±‚:
å¦‚æœåº”ç­”çš„æ˜¯ CONNECT è¯·æ±‚, åˆ™ BND.PORT éœ€åŒ…å«æœåŠ¡å™¨è¿æ¥ç›®æ ‡ä¸»æœºæ‰€ç”¨çš„ç«¯å£å·, BND.ADDR åŒ…å«ç›¸åº”çš„ IP åœ°å€. 
è¿™é‡Œçš„ BND.ADDR å¸¸å¸¸ä¸åŒäºå®¢æˆ·ç«¯è®¿é—®çš„ SOCKS æœåŠ¡å™¨çš„åœ°å€, å› ä¸ºæœåŠ¡å™¨å¸¸å¸¸æ˜¯åˆ†å¸ƒå¼éƒ¨ç½²çš„. 
æœåŠ¡å™¨é€šå¸¸ä¼šä½¿ç”¨ DST.ADDR å’Œ DST.PORT, ä»¥åŠå®¢æˆ·ç«¯çš„æºåœ°å€å’Œç«¯å£, æ¥è¯„ä¼° CONNECT è¯·æ±‚.


å®‰å…¨è€ƒè™‘:
æè¿°äº†ä¸€ä¸ªè®©åº”ç”¨å±‚ç©¿è¶Š IP ç½‘ç»œé˜²ç«å¢™çš„åè®®. 
è¿™ç§ç©¿è¶Šçš„å®‰å…¨æ€§é«˜åº¦ä¾èµ–äºç‰¹å®šå®ç°ä¸­æä¾›çš„ç‰¹å®šè®¤è¯æ–¹æ³•å’Œå°è£…, å®ƒä»¬æ˜¯åœ¨ SOCKS å®¢æˆ·ç«¯å’Œ SOCKS æœåŠ¡å™¨åœ¨åå•†è¿‡ç¨‹ä¸­é€‰æ‹©çš„.


==================================================https://en.wikipedia.org/wiki/Firewall_(computing)
é˜²ç«å¢™çš„ä½¿ç”¨å˜å¾—è¶Šæ¥è¶Šæµè¡Œ, å®ƒå¯ä»¥æœ‰æ•ˆåœ°å°†ç»„ç»‡å†…éƒ¨ç½‘ç»œä¸å¤–éƒ¨ç½‘ç»œ (å¦‚å› ç‰¹ç½‘) éš”ç¦».

In computing, a firewall is a network security system that monitors and controls incoming and outgoing network traffic based on configurable security rules.
A firewall typically establishes a barrier between a trusted network and an untrusted network, such as the Internet or between several VLANs. 
Firewalls can be categorized as network-based or host-based.

é˜²ç«å¢™çš„é˜»æŒ¡é€»è¾‘:
é˜²ç«å¢™æ˜¯æ ¹æ® æµé‡çš„æ–¹å‘ã€æºåœ°å€ã€ç›®æ ‡åœ°å€ã€ç«¯å£å·ã€åè®®ç±»å‹ ç­‰è§„åˆ™æ¥å†³å®šæ˜¯å¦å…è®¸é€šä¿¡çš„ã€‚
é€šå¸¸å®ƒä¼šï¼š
é˜»æ­¢å†…éƒ¨ä¸»æœºç›´è¿å¤–éƒ¨æŸäº›åœ°å€/ç«¯å£ï¼›
ä½†å…è®¸è®¿é—®æŸä¸ªå—ä¿¡ä»»çš„å‡ºå£ï¼Œæ¯”å¦‚å…¬å¸ç»Ÿä¸€çš„ä»£ç†æœåŠ¡å™¨ã€‚
æ‰€ä»¥ï¼š
ğŸ”¹ A æ— æ³•ç›´æ¥è®¿é—® Bï¼Œæ˜¯å› ä¸ºé˜²ç«å¢™è§„åˆ™ç¦æ­¢äº†ã€ŒA â†’ Bã€çš„è¿æ¥ã€‚
ğŸ”¹ ä½†é˜²ç«å¢™å…è®¸ã€ŒA â†’ ä»£ç†æœåŠ¡å™¨ã€çš„è¿æ¥ã€‚


ä»£ç†æœåŠ¡å™¨é€šå¸¸ä½äºï¼š
é˜²ç«å¢™å¤–ä¾§ï¼ˆå¯ä»¥è®¿é—®äº’è”ç½‘ï¼‰ï¼Œæˆ–è€…
é˜²ç«å¢™å…è®¸çš„å‡ºå£ç™½åå•ä¸­ã€‚
å› æ­¤å®ƒå…·å¤‡ï¼š
âœ… èƒ½åŒæ—¶è®¿é—®å†…ç½‘ï¼ˆAï¼‰å’Œå¤–ç½‘ï¼ˆBï¼‰çš„æƒé™ã€‚
A (å†…ç½‘)
   â†“
[é˜²ç«å¢™å…è®¸å‡ºå£ï¼šSOCKS ä»£ç†]
   â†“
Proxyï¼ˆå¤–ç½‘å¯è®¿é—®ï¼‰
   â†“
Bï¼ˆç›®æ ‡ä¸»æœºï¼‰


é˜²ç«å¢™ æŠŠç½‘ç»œåˆ†æˆä¸¤éƒ¨åˆ†ï¼š
å·¦è¾¹ï¼ˆå†…ç½‘åŒºï¼‰ï¼šä¸»æœº A
å³è¾¹ï¼ˆå¤–ç½‘åŒºï¼‰ï¼šäº’è”ç½‘ / B
é˜²ç«å¢™è§„åˆ™ï¼š
ğŸš« é˜»æ­¢ A ç›´æ¥è®¿é—® Bï¼›
âœ… å…è®¸ A è®¿é—®ç‰¹å®šå‡ºå£ï¼ˆä¾‹å¦‚ä»£ç†æœåŠ¡å™¨çš„åœ°å€ï¼‰ã€‚
å› æ­¤ï¼š
A â†’ Proxy âœ… è¢«å…è®¸ï¼›
Proxy â†’ B âœ… ä¸å—é™åˆ¶ï¼›
A â†’ B âŒ è¢«é˜²ç«å¢™é˜»æ–­ã€‚
#####
é˜²ç«å¢™åƒä¸€å µå¢™ï¼ŒA åœ¨å·¦è¾¹ï¼ŒB åœ¨å³è¾¹ã€‚
Proxy ç«™åœ¨å³è¾¹ï¼ˆå¢™å¤–ï¼‰ï¼Œæ‰€ä»¥å®ƒå¯ä»¥å¸® A å»å’Œ B é€šä¿¡ã€‚
A åªèƒ½é€šè¿‡é˜²ç«å¢™ä¸Šä¸“é—¨å¼€çš„å°é—¨ï¼ˆä»£ç†ç«¯å£ï¼‰ä¸ Proxy å¯¹è¯ã€‚
#####


SOCKS5 åè®®æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ª é€šç”¨ TCP/UDP è½¬å‘åè®®ï¼š
A å…ˆå’Œ Proxy å»ºç«‹è¿æ¥ï¼›
A å‘Šè¯‰ Proxyï¼šã€Œè¯·å¸®æˆ‘è¿æ¥åˆ° B:portã€ï¼›
Proxy è‡ªå·±å»å’Œ B å»ºç«‹ TCP è¿æ¥ï¼›
Proxy å‘Šè¯‰ Aï¼šã€Œè¿æ¥æˆåŠŸã€ï¼Œå¹¶å¼€å§‹ ä¸­ç»§ä¼ è¾“æ•°æ®ã€‚

A å¹¶æ²¡æœ‰ç›´æ¥ç©¿è¶Šé˜²ç«å¢™å»è®¿é—® Bï¼Œè€Œæ˜¯è®©é˜²ç«å¢™å…è®¸çš„ã€Œå‡ºå£ä»£ç†ã€å¸®å®ƒè®¿é—®ã€‚