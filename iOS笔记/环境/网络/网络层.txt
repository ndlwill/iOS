https://mp.weixin.qq.com/s?__biz=MzI0ODk2NDIyMQ==&mid=2247487351&idx=1&sn=9aa613589f85ce4c0c4142274e2a287d&chksm=e999fa65deee73732f97267db0e58d28925f4c57f7850d1e3b4633275385ac844e204fd03f03&scene=178&cur_album_id=1629017939758596097#rd

分组网络
即使在两个节点通信的过程中，几个节点遭到破坏，却依然能够通过改变线路等方式使两个节点之间进行通信。

TCP/IP 的标准协议就是我们所熟知的 RFC 文档
RFC 协议
https://www.rfc-editor.org/rfc-index.html

物理层是 TCP/IP 的最底层是负责传输的硬件，这种硬件就相当于是以太网或电话线路等物理层的设备。
数据链路层位于物理层和网络层中间，数据链路层定义了在单个链路上如何传输数据。

虽然 IP 也是一种分组交换协议，但是 IP 却不具备重发机制。即使数据没有到达另一端也不会进行重发，所以 IP 属于非可靠性协议。

网络层还有一种协议就是 ICMP，因为 IP 在数据包的发送过程中可能会出现异常，当 IP 数据包因为异常而无法到达目标地址时，需要给发送端发送一个异常通知
ICMP 也可以被用来诊断网络情况

==================================================路由器

网络层的作用从表面看上去非常简单，即将分组从一台主机移动到另外一台主机。为了实现这个功能，网络层需要两种功能:
转发：因为在互联网中有很多路由器的存在，而路由器是构成互联网的根本，路由器最重要的一个功能就是分组转发，当一个分组到达某路由器的一条输入链路时，该路由器会将分组移动到适当的输出链路
路由选择：当分组由发送方流向接收方时，网络层必须选择这些分组的路径。计算这些路径选择的算法被称为 路由选择算法(routing algorithm)。

在网络中存在两种平面的选择:
数据平面(data plane)：负责转发网络流量，如路由器交换机中的转发表
控制平面(control plane)：控制网络的行为，比如网络路径的选择

也就是说，转发是指将分组从一个输入链路转移到适当输出链路接口的路由器本地动作。
而路由选择是指确定分组从源到目的地所定位的路径的选择。

每台路由器都有一个关键的概念就是 转发表(forwarding table)。
路由器通过检查数据包标头中字段的值，来定位转发表中的项来实现转发。
标头中的值即对应着转发表中的值，这个值指出了分组将被转发的路由器输出链路。

路由器工作原理:
输入端口：输入端口(input port)有很多功能。线路终端功能和数据链路处理功能，这两个功能实现了路由器的单个输入链路相关联的物理层和数据链路层。输入端口查找/转发功能对路由器的交换功能来说至关重要，由路由器的交换结构来决定输出端口，具体来讲应该是查询转发表来确定的。
交换结构：交换结构(Switching fabric)就是将路由器的输入端口连接到它的输出端口。这种交换结构相当于是路由器内部的网络。
输出端口：输出端口(Output ports) 通过交换结构转发分组，并通过物理层和数据链路层的功能传输分组，因此，输出端口作为输入端口执行反向数据链接和物理层功能。
路由选择处理器：路由选择处理器(Routing processor) 在路由器内执行路由协议，维护路由表并执行网络管理功能。

输入端口:
每个输入端口中都有一个路由处理器维护的路由表的副本，根据路由处理器进行更新
在输入端口处理能力有限的路由器中，输入端口不会进行交换功能，而是由路由处理器统一处理，然后根据 路由表查找并将数据包转发到相应的输出端口。
输入端口会根据转发表定位输出端口，然后再会进行分组转发

比如这时有一个分组是 11000011 10010101 00010000 0001100 到达，因为这个分组与 11000011 10010101 00010000 相匹配，所以路由器会转发到 0 链路接口上。
路由匹配遵循 最长前缀原则(longest prefix matching rule)，最长匹配原则故名思义就是如果有两个匹配项一个长一个短的话，就匹配最长的。
一旦通过查找功能确定了分组的输出端口后，那么该分组就会进入交换结构。
在进入交换结构时，如果交换结构正在被使用，就会阻塞新到的分组，等到交换结构调度新的分组。

交换结构:
交换结构是路由器的核心功能，通过交换功能把分组从输入端口转发至输出端口，这就是交换结构的主要功能。

输出端口:
在输入端口中有等待进入交换的排队队列，而在输出端口中有等待转发的排队队列