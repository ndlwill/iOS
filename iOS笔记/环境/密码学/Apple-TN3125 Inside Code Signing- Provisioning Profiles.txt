https://developer.apple.com/documentation/technotes/tn3125-inside-code-signing-provisioning-profiles

Learn how provisioning profiles enable third-party code to run on Apple platforms.


Code signing is a foundational technology on all Apple platforms. 
The Inside Code Signing technote series is different: It peeks behind the code signing curtain, to give you a better understanding of how this technology works.


When signing code, use Xcode (all platforms) or the codesign tool (macOS only).
To get information or validate a code signature, use the codesign tool or the Code Signing Services API.
https://developer.apple.com/documentation/Security/code-signing-services
Apple updates these facilities to accommodate any changes to the code signature structure as they roll out.



==================================================Provisioning profile fundamentals
Apple platforms, except macOS, wonâ€™t run arbitrary third-party code. 
All execution of third-party code must be authorized by Apple. 
This authorization comes in the form of a provisioning profile, which ties together five criteria:

Who is allowed to sign code?
What apps are they allowed to sign?
Where can those apps run?
When can those apps run?
How can those apps be entitled?

Note
In this document the term app refers to a main executable packaged in a bundle structure. 
This encompasses apps, app extensions, App Clips, system extensions, and XPC Services.

You create provisioning profiles using the Apple Developer website, either directly using the website or indirectly using Xcode or the App Store Connect API.
https://developer.apple.com/documentation/AppStoreConnectAPI


#####
When the Apple Developer website creates a profile for you, it cryptographically signs it. 
When you run an app on a device, the device checks this signature to determine if the profile is valid and, if so, 
checks that the app meets the criteria in the profile.
#####


Note
Unlike Appleâ€™s other platforms, macOS doesnâ€™t require a provisioning profile to run third-party code. 
However, provisioning profiles are still relevant on macOS, as explained in Entitlements on macOS.


#####
There is one interesting edge case with provisioning profiles: When you submit your app to the App Store, 
the App Store re-signs the app as part of the distribution process. 
Before doing that, it checks that the app is signed and provisioned correctly. 
That check means that each individual device doesnâ€™t need to perform further security checks, so the final app doesnâ€™t have a provisioning profile. 
However, this third-party code was still authorized by a profile, albeit during the App Store distribution process.
#####



==================================================Unpack a profile
A provisioning profile is a property list wrapped within a Cryptographic Message Syntax (CMS) signature. 
To view the original property list, remove the CMS wrapper using the security tool:

// è¿™æ¡å‘½ä»¤æ˜¯ç”¨ macOS è‡ªå¸¦çš„ security å‘½ä»¤è¡Œå·¥å…·ä¸­çš„ cms å­å‘½ä»¤æ¥è§£æä¸€ä¸ª iOS çš„æè¿°æ–‡ä»¶ï¼ˆ.mobileprovisionï¼‰ï¼Œå°†å…¶ä¸­çš„å†…å®¹æå–ä¸ºå¯è¯»çš„ plist æ–‡ä»¶ï¼ˆ.plistï¼‰æ ¼å¼ã€‚
% security cms -D -i Profile_Explainer_iOS_Dev.mobileprovision -o Profile_Explainer_iOS_Dev-payload.plist
% cat Profile_Explainer_iOS_Dev-payload.plist 
â€¦
<dict>
  â€¦ lots of properties â€¦
</dict>
</plist>


For more details on CMS, see RFC 5652.
https://datatracker.ietf.org/doc/html/rfc5652


#####
Important
The exact format of provisioning profiles isnâ€™t documented and could change at any time. 
Use the techniques shown here for understanding and debugging purposes. 
Avoid building a product based on these details; if you do build such a product, be prepared to update it as the Apple development story evolves.
#####


To illustrate this point, the traditional property list view of a profile is no longer the source of truth on modern systems. 
Rather, each profile contains a DER-Encoded-Profile property which holds a binary form of the profile thatâ€™s the new source of truth. 
For more on this switch, see The Future is DER.


Reading UNIX Manual Pages
https://developer.apple.com/documentation/os/reading-unix-manual-pages


The who:
Every profile has a DeveloperCertificates property holding the certificates of each developer who can sign code covered by the profile. For example:
å¯¹ä¸Šé¢è¿™å¥è¯çš„ç†è§£ï¼š
æ¯ä¸ª Apple çš„ Provisioning Profile é‡Œé¢ï¼Œéƒ½åŒ…å«äº†ä¸€äº›å¯ä»¥ä½¿ç”¨è¿™ä¸ª Profile è¿›è¡Œä»£ç ç­¾åçš„ å¼€å‘è€…è¯ä¹¦ï¼ˆDeveloper Certificatesï¼‰ã€‚
ä¸¾ä¸ªå…·ä½“ä¾‹å­ï¼š
ä½ åˆ›å»ºäº†ä¸€ä¸ª iOS App çš„ å¼€å‘ç”¨ Provisioning Profileï¼ˆDevelopment Profileï¼‰ï¼Œé‡Œé¢å…³è”äº†ï¼š
App IDï¼ˆä¾‹å¦‚ï¼šcom.yourcompany.myappï¼‰
ä¸€äº› Devicesï¼ˆæ¯”å¦‚ä½ æµ‹è¯•çš„ iPhoneï¼‰
å¤šä¸ªå¼€å‘è€…çš„è¯ä¹¦ï¼ˆä½ å’Œå›¢é˜Ÿæˆå‘˜ï¼‰
è¿™ä¸ª profile çš„ DeveloperCertificates å±æ€§å°±åŒ…å«äº†è¿™äº›äººçš„ å…¬é’¥è¯ä¹¦ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼š
åªæœ‰è¿™äº›äººåœ¨è‡ªå·±çš„ Mac ä¸Šï¼Œç”¨å¯¹åº”çš„ ç§é’¥ é…åˆè¿™ä¸ª profileï¼Œæ‰èƒ½åˆæ³•åœ°å¯¹è¿™ä¸ª App ç­¾åå¹¶éƒ¨ç½²åˆ°è®¾å¤‡ä¸Šã€‚

//  ä»è§£æå‡ºçš„ .plist æ–‡ä»¶ä¸­æå–å‡º DeveloperCertificates å­—æ®µå†…å®¹ï¼Œå¹¶ä»¥ XML æ ¼å¼è¾“å‡ºåˆ°ç»ˆç«¯ã€‚
plutil -extract DeveloperCertificates xml1 -o - Profile_Explainer_iOS_Dev-payload.plist

To extract a specific certificate, add its index to the key path:
// ä» provisioning profile ä¸­æå–ç¬¬ä¸€ä¸ªå¼€å‘è€…è¯ä¹¦ï¼ˆDeveloperCertificates[0]ï¼‰ï¼Œè§£ç å¹¶ä¿å­˜ä¸º .cer æ ¼å¼çš„äºŒè¿›åˆ¶è¯ä¹¦æ–‡ä»¶
plutil -extract DeveloperCertificates.0 raw -o - Profile_Explainer_iOS_Dev-payload.plist | base64 -D > cert0.cer
certtool d cert0.cer // ä½¿ç”¨ macOS è‡ªå¸¦çš„ certtool å·¥å…·ï¼Œè§£ç å¹¶â€œäººç±»å¯è¯»â€åœ°æ˜¾ç¤º cert0.cer æ–‡ä»¶ä¸­çš„è¯ä¹¦å†…å®¹ã€‚


The what:
Most profiles apply to a single App ID, encoded in the Entitlements > application-identifier property:
plutil -extract Entitlements.application-identifier raw -o - Profile_Explainer_iOS_Dev-payload.plist

Note
On macOS the standard App ID entitlement is com.apple.application-identifier. 
A Mac Catalyst app uses both com.apple.application-identifier and application-identifier.

This property holds an App ID, composed of an App ID prefix and a bundle ID. 
In this example SKMME9E2Y8 is the App ID prefix and com.example.apple-samplecode.ProfileExplainer is the bundle ID.

A profile might refer to a wildcard App ID:
security cms -D -i Profile_Explainer_Wild_iOS_Dev.mobileprovision -o Profile_Explainer_Wild_iOS_Dev-payload.plist
plutil -extract Entitlements.application-identifier raw -o - Profile_Explainer_Wild_iOS_Dev-payload.plist
SKMME9E2Y8.com.example.apple-samplecode.*
This profile applies to any app whose App ID starts with SKMME9E2Y8.com.example.apple-samplecode.


The where:
Most profiles apply to a specific list of devices. This is encoded in the ProvisionedDevices property:

plutil -extract ProvisionedDevices xml1 -o - Profile_Explainer_iOS_Dev-payload.plist 

App Store distribution profiles have no ProvisionedDevices property because you canâ€™t run an App Store distribution signed app locally.

Developer ID and In-House (Enterprise) distribution profiles have the ProvisionsAllDevices property, indicating that they apply to all devices. 
or more details about Developer ID provisioning profiles on the Mac, see Entitlements on macOS.

ProvisionedDevices è¿™ä¸ªå­—æ®µåªå‡ºç°åœ¨ å¼€å‘ç”¨ æˆ– Ad Hoc åˆ†å‘ çš„ profile ä¸­ï¼Œç”¨äºåˆ—å‡ºå¯ä»¥å®‰è£… app çš„è®¾å¤‡ UDIDã€‚

åˆ†å‘æ–¹å¼	ä½¿ç”¨çš„ Profile ç±»å‹	æ˜¯å¦åŒ…å«è®¾å¤‡åˆ—è¡¨ ProvisionedDevices	å®‰è£…æ–¹å¼	ç›®çš„å’Œé€‚ç”¨åœºæ™¯
Development	Development Profile	âœ… æ˜¯	Xcode ç›´è¿å®‰è£…	æœ¬åœ°å¼€å‘è°ƒè¯•ã€çœŸæœºæµ‹è¯•
Ad Hoc	Distribution Profileï¼ˆAd Hocï¼‰	âœ… æ˜¯	æ‰‹åŠ¨å®‰è£… .ipaï¼Œæˆ– MDM	å†…éƒ¨å°è§„æ¨¡æµ‹è¯•ï¼Œæœ€å¤š 100 å°è®¾å¤‡
App Store	Distribution Profileï¼ˆApp Storeï¼‰	âŒ å¦	App Store ä¸‹è½½	é¢å‘å…¬ä¼—çš„æ­£å¼å‘å¸ƒ
TestFlight	Distribution Profileï¼ˆApp Storeï¼‰	âŒ å¦	TestFlight App ä¸‹è½½	beta æµ‹è¯•ï¼Œæœ€å¤š 10,000 ä¸ªæµ‹è¯•ç”¨æˆ·
Enterpriseï¼ˆIn-Houseï¼‰	Enterprise Profile	âŒ å¦	MDM æˆ–ç½‘ç«™/å·¥å…·å®‰è£…	ä¼ä¸šå†…éƒ¨å¤§è§„æ¨¡åˆ†å‘ï¼ˆéœ€ä¼ä¸šè´¦å·ï¼‰


TestFlight åˆ†å‘
å®ƒè·Ÿ App Store åˆ†å‘æŠ€æœ¯ä¸Šå‡ ä¹ä¸€è‡´ï¼Œåªæ˜¯èµ°äº†å¦ä¸€æ¡æµ‹è¯•è·¯å¾„ã€‚
å¯åˆ†å‘ç»™æœ€å¤š 10,000 åæµ‹è¯•ç”¨æˆ·ï¼ˆåŒ…æ‹¬å†…éƒ¨å’Œå¤–éƒ¨ï¼‰
TestFlight æ˜¯ä¸€ä¸ª é¢„å‘å¸ƒæµ‹è¯•æ¸ é“ï¼ŒApple å¹¶ä¸ä¼šä¿®æ”¹æˆ–é‡æ–°ç­¾åä½ ä¸Šä¼ çš„ appï¼Œç³»ç»Ÿä¾èµ–ä½ æ‰€é™„å¸¦çš„ provisioning profile æ¥åˆ¤æ–­æƒé™ã€å®‰è£…æ¡ä»¶ï¼Œå¦åˆ™è®¾å¤‡æ— æ³•å®‰è£…è¿è¡Œã€‚


The when:
Every profile has an ExpirationDate property which limits how long the profile remains valid. For example:
plutil -extract ExpirationDate raw -o - Profile_Explainer_iOS_Dev-payload.plist

This validity period varies by profile type, but itâ€™s typically not more than a year. The exception here is Developer ID profiles, which have an expiration date far in the future.


The how:
Every profile has an Entitlements property which authorizes the app to use specific entitlements. For example:
plutil -extract Entitlements xml1 -o - Profile_Explainer_iOS_Dev-payload.plist
â€¦
<dict>
  <key>application-identifier</key>
  <string>SKMME9E2Y8.com.example.apple-samplecode.ProfileExplainer</string>
  <key>com.apple.developer.team-identifier</key>
  <string>SKMME9E2Y8</string>
  <key>get-task-allow</key>
  <true/>
  <key>keychain-access-groups</key>
  <array>
    <string>SKMME9E2Y8.*</string>
    <string>com.apple.token</string>
  </array>
</dict>
</plist>

The entitlements in the profile act as an allowlist. This isnâ€™t the same as the entitlements claimed by the app. 
To actually claim an entitlement, include the entitlement in the appâ€™s code signature.

Every entitlement claimed by the app must be in the profileâ€™s allowlist but the reverse isnâ€™t true. 
Itâ€™s fine for the allowlist to include entitlements that the app doesnâ€™t claim.

Note
A macOS app can claim certain entitlements without them being authorized by a provisioning profile. 
For more on this, see Entitlements on macOS.

Some entitlements in the allowlist use wildcard syntax. 
In the above example, SKMME9E2Y8.* means that the app can claim any keychain access group with the SKMME9E2Y8. prefix. 
Wildcards donâ€™t make sense in the appâ€™s code signature.


To dump the entitlements claimed by the app, use codesign with the --entitlements argument:
æŸ¥çœ‹å·²ç­¾åçš„ appï¼ˆæˆ–å¯æ‰§è¡Œæ–‡ä»¶ï¼‰ä¸­åŒ…å«çš„ entitlements æƒé™å£°æ˜ï¼Œä»¥ XML æ ¼å¼è¾“å‡ºã€‚
codesign --display --entitlements - --xml ProfileExplainer.app | plutil -convert xml1 -o - -
â€¦
<dict>
  <key>application-identifier</key>
  <string>SKMME9E2Y8.com.example.apple-samplecode.ProfileExplainer</string>
  <key>com.apple.developer.team-identifier</key>
  <string>SKMME9E2Y8</string>
  <key>get-task-allow</key>
  <true/>
  <key>keychain-access-groups</key>
  <array>
    <string>SKMME9E2Y8.com.example.apple-samplecode.ProfileExplainer</string>
    <string>SKMME9E2Y8.com.example.apple-samplecode.shared</string>
  </array>
</dict>
</plist>

Note

By default --entitlements dumps a human-readable representation of the DER-encoded entitlements. 
The above example uses --xml to force it to output XML. 
It runs the output through plutil to pretty print that XML. To learn more about DER in provisioning profiles, see The Future is DER.

Every entitlement claimed by this app is authorized by its profile, and thus iOS allows the app to run. 
Note that the keychain-access-groups value, SKMME9E2Y8.com.example.apple-samplecode.ProfileExplainer, 
starts with SKMME9E2Y8. and thus is allowed by the wildcard.


==================================================Entitlements on macOS
A macOS app can claim certain entitlements without them being authorized by a provisioning profile. These unrestricted entitlements include:
com.apple.security.get-task-allow
com.apple.security.application-groups
Those used to enable and configure the App Sandbox // https://developer.apple.com/documentation/Security/app-sandbox
Those used to configure the Hardened Runtime// https://developer.apple.com/documentation/Security/hardened-runtime

Note
On other Apple platforms the equivalent to com.apple.security.get-task-allow is get-task-allow and, as with all entitlements on those platforms, 
must be authorized by a profile. Also, App Groups work differently on macOS and other platforms. For details, see App Groups Entitlement.
https://developer.apple.com/documentation/BundleResources/Entitlements/com.apple.security.application-groups

In contrast, restricted entitlements must be authorized by a provisioning profile. 
This is an important security feature on macOS. 
For example, the fact that the keychain-access-groups entitlement must be authorized by a profile means that other developers canâ€™t impersonate your app in order to steal its keychain items.

###
A Mac app that uses no restricted entitlements doesnâ€™t need a provisioning profile. 
This is true even if the app is distributed on the App Store. 
The only exception to this rule is TestFlight, which always requires a profile.
###

macOS supports provisioning profiles for both App Store and Developer ID distribution. 
Some entitlements are not supported by Developer ID profiles.
For the details, see Supported capabilities (macOS) in Developer Account Help. 
https://developer.apple.com/help/account#/devadf555df9
For general information about Developer ID signing, see Signing Mac Software with Developer ID
https://developer.apple.com/developer-id/  // Signing your apps for Gatekeeper
Gatekeeper æ˜¯ macOS ä¸Šçš„ä¸€é¡¹å®‰å…¨æœºåˆ¶ï¼Œå®ƒçš„ä¸»è¦ä½œç”¨æ˜¯ é˜²æ­¢ç”¨æˆ·è¿è¡Œæœªç»è¿‡è®¤è¯çš„æ¶æ„è½¯ä»¶ã€‚å®ƒæ˜¯ Apple ç”¨æ¥ä¿æŠ¤ç”¨æˆ·ç³»ç»Ÿå…å—æ¶æ„ App ä¾µå®³çš„ä¸€é“â€œç¬¬ä¸€é“é˜²çº¿â€ã€‚


åˆ†å‘æ–¹å¼	Apple æ˜¯å¦é‡ç­¾å	æ˜¯å¦éœ€è¦å¼€å‘è€…ç­¾åæ—¶é™„å¸¦ profile
App Storeï¼ˆæ­£å¼å‘å¸ƒï¼‰	âœ… æ˜¯ï¼Œç”± Apple é‡æ–°ç­¾å	âŒ å¯ä»¥ä¸é™„å¸¦ï¼ˆå¦‚æœæ²¡ç‰¹æ®Šæƒé™ï¼‰// è¿™è¾¹æŒ‡çš„æ˜¯ä¸Šä¼ åˆ° app store æ—¶ï¼Œéœ€è¦åŒ…å« provisioning profile
TestFlight	âŒ å¦ï¼Œä¿ç•™ä½ çš„ç­¾å	âœ… å¿…é¡»é™„å¸¦ provisioning profile

è™½ç„¶ App Store æœ€ç»ˆä¼šé‡ç­¾åä½ çš„ Appï¼Œä½†æŸäº›æƒ…å†µä¸‹ä½ åœ¨ä¸Šä¼  App åˆ° App Store ä¹‹å‰ï¼Œä¾ç„¶éœ€è¦ä½¿ç”¨ä¸€ä¸ªæœ‰æ•ˆçš„ Provisioning Profile æ¥å®Œæˆæ„å»ºå’Œç­¾åã€‚
import CloudKit
import PushKit
è¿™äº›åŠŸèƒ½éƒ½è¦æ±‚ä½ å¼€å¯ç›¸å…³ capabilityï¼Œæ¯”å¦‚ï¼š
iCloud
Push Notifications
è¿™å°±æ„å‘³ç€ä½ å¿…é¡»åœ¨ä½ çš„ Provisioning Profile ä¸­å£°æ˜è¿™äº› entitlementsï¼Œå¦åˆ™ä½ åœ¨ Xcode æ‰“åŒ…æ—¶ä¼šå¤±è´¥ï¼Œæˆ–è€…æ‰“åŒ…çš„ App ç¼ºå°‘æ‰€éœ€æƒé™ï¼Œä¸Šä¼  App Store Connect ä¼šæŠ¥é”™ã€‚


iOS App ä½¿ç”¨æŸäº›å—é™æƒé™
å¦‚ï¼š
App Groups
Associated Domainsï¼ˆå¦‚ Universal Linksï¼‰
HealthKit
Apple Pay
Sign in with Apple
Background Modes
CarPlay ç­‰
è¿™äº›éƒ½éœ€è¦åœ¨ Apple Developer ä¸­æ³¨å†Œï¼Œå¹¶é€šè¿‡ Profile ç­¾åæ—¶åµŒå…¥ã€‚


Code Signing:
å¯¹ .app è¿›è¡Œç­¾åï¼Œå¹¶åœ¨æ­¤é˜¶æ®µï¼š
ğŸ‘‰ åµŒå…¥ embedded.mobileprovisionï¼ˆå³æè¿°æ–‡ä»¶ï¼‰ // æ‹·è´è¿›ä½ çš„ app bundle çš„æ ¹ç›®å½•ä¸‹.ç­¾åå‘½ä»¤ï¼ˆcodesignï¼‰ä¼šæ ¹æ®å®ƒä»¥åŠå¯¹åº”çš„ .entitlements æ¥ç”Ÿæˆå®Œæ•´çš„ç­¾åã€‚codesignå®ƒçš„ä½œç”¨æ˜¯ï¼šè¯æ˜è¯¥ç¨‹åºæ¥è‡ªå¯ä¿¡å¼€å‘è€…ï¼Œå¹¶ä¸”æœªè¢«ç¯¡æ”¹ã€‚
ğŸ‘‰ æ³¨å…¥ entitlements


codesign çš„ä½œç”¨:
1. âœ… å®Œæ•´æ€§æ ¡éªŒï¼ˆIntegrityï¼‰
codesign ä¼šå¯¹ä½ çš„å¯æ‰§è¡Œæ–‡ä»¶ã€èµ„æºç­‰ç”Ÿæˆå“ˆå¸Œæ‘˜è¦ï¼Œå¹¶ç­¾åå†™å…¥ã€‚
è¿è¡Œæ—¶ç³»ç»Ÿä¼šéªŒè¯æ–‡ä»¶æ˜¯å¦è¢«æ”¹åŠ¨ï¼Œå¦‚æœæ”¹äº†ç­¾åä¼šå¤±æ•ˆï¼Œæ— æ³•è¿è¡Œã€‚
2. âœ… èº«ä»½è®¤è¯ï¼ˆIdentityï¼‰
ç­¾åä½¿ç”¨ä½ çš„å¼€å‘/åˆ†å‘è¯ä¹¦ï¼ˆprivate keyï¼‰å®Œæˆï¼Œè¯ä¹¦é“¾æœ€ç»ˆè¿½æº¯åˆ° Apple Root CAã€‚
ç³»ç»Ÿå°±çŸ¥é“è¿™ä¸ª App æ˜¯ç”±ä½ ï¼ˆå¼€å‘è€…è´¦å·ï¼‰ç­¾åå¹¶æ„å»ºçš„ã€‚
3. âœ… æƒé™å£°æ˜ï¼ˆEntitlementsï¼‰
codesign ä¼šå°† Entitlements.plist å†…å®¹ï¼ˆä¾‹å¦‚ iCloudã€Pushã€App Groups æƒé™ï¼‰å†™å…¥ç­¾åç»“æ„ã€‚
å®‰è£…å’Œè¿è¡Œæ—¶ï¼Œç³»ç»Ÿä¼šéªŒè¯è¿™äº›æƒé™æ˜¯å¦åˆæ³•ï¼Œæ˜¯å¦ä¸ä½ çš„ provisioning profile åŒ¹é…ã€‚


ä¸ºä»€ä¹ˆ App Store åŒ…ä¹Ÿè¦å¸¦æè¿°æ–‡ä»¶ï¼Ÿ
å› ä¸º Apple ä¼šåœ¨å®¡æ ¸å’Œç­¾åéªŒè¯æ—¶ï¼š
ç¡®ä¿ä½ å£°æ˜çš„ entitlements ç¬¦åˆä½  App ID çš„æƒé™è®¾ç½®ï¼›
éªŒè¯ç­¾åçš„ entitlements ä¸ embedded.mobileprovision ä¸­çš„ä¸€è‡´ï¼›
ç¡®ä¿ä½ æ²¡æœ‰ä¼ªé€ æƒé™ã€‚


åœºæ™¯	æ˜¯å¦æœ‰ embedded.mobileprovision	è¯´æ˜
App Store ä¸‹è½½çš„æ­£å¼ App	âŒ æ²¡æœ‰	ä¸éœ€è¦æè¿°æ–‡ä»¶ï¼Œè‹¹æœç»Ÿä¸€éªŒè¯ç­¾å // å› ä¸º App Store åœ¨å®¡æ ¸æ—¶å·²éªŒè¯ç­¾åå’Œæƒé™
TestFlight åˆ†å‘ App	âœ… æœ‰	TestFlight ä»ä¾èµ–æè¿°æ–‡ä»¶æ¥æ§åˆ¶è®¾å¤‡å’Œæƒé™
Ad Hoc / Enterprise å®‰è£… App	âœ… æœ‰	å¿…é¡»åŒ…å«æè¿°æ–‡ä»¶æ¥å…è®¸å®‰è£…åˆ°ç‰¹å®šè®¾å¤‡
å¼€å‘æˆ–è°ƒè¯•ç”¨åŒ…ï¼ˆXcode æ„å»ºï¼‰	âœ… æœ‰	ç”¨äºå¼€å‘è€…ç­¾åå’Œæƒé™æ§åˆ¶


==================================================Profile location
current best practice is to embed the profile within the app itself:

macOS expects to find the profile at MyApp.app/Contents/embedded.provisionprofile.
Other Apple platforms expect to find the profile at MyApp.app/embedded.mobileprovision.

Note that macOS also uses a different file name extension for provisioning profiles.


#####è¿™è¾¹æŒ‡çš„æ˜¯ä» app store ä¸‹è½½ ipaï¼Œä¸ä¼šåŒ…å« embedded provisioning profile
Apps that you download from the App Store donâ€™t contain an embedded provisioning profile because the App Store checks that the app is signed and provisioned correctly as part of its distribution process.

å·²éªŒè¯ï¼šapp store ä¸‹è½½ ipa
ajs app & dingding app éƒ½æ²¡æœ‰ embedded provisioning profile
#####

Some macOS products, like daemons and command-line tools, ship as a standalone executable. 
A standalone executable canâ€™t claim a restricted entitlement because thereâ€™s no place to embed the provisioning profile that authorizes that claim. 
If your standalone executable needs to do this, wrap it in an app-like structure. 
For an example of this, see Signing a Daemon with a Restricted Entitlement.
https://developer.apple.com/documentation/Xcode/signing-a-daemon-with-a-restricted-entitlement


==================================================The future is DER
Modern systems no longer treat the profileâ€™s property list as the source of truth. 
Rather, they use the binary form of the profile stored in the profileâ€™s DER-Encoded-Profile property:
plutil -extract DER-Encoded-Profile raw -o - Profile_Explainer_iOS_Dev-payload.plist

This form of the profile is encoded as DER, a binary encoding of ASN.1 thatâ€™s common in cryptographic file formats. 
To extract it, first extract the property to a file:
plutil -extract DER-Encoded-Profile raw Profile_Explainer_iOS_Dev-payload.plist | base64 -D > Profile_Explainer_iOS_Dev.der 
This is a whole new copy of the profile, so undo the CMS wrapper again: // CMS: Cryptographic Message Syntaxï¼ˆåŠ å¯†æ¶ˆæ¯è¯­æ³•ï¼‰
security cms -D -i Profile_Explainer_iOS_Dev.der -o Profile_Explainer_iOS_Dev-payload.der 
Finally, dump the DER-encoded payload itself:
openssl asn1parse -in Profile_Explainer_iOS_Dev-payload.der -inform der -i | cut -c 30- 
This output contains mostly the same information as the property list, just encoded in DER form.

The one exception is the DeveloperCertificates property. 
This doesnâ€™t contain a full copy of each certificate, but rather a SHA-256 checksum of the certificate. 
Assuming the certificate extracted from the property list earlier as cert0.cer, run shasum to confirm that checksum:
shasum -a 256 cert0.cer

This DER-encoded profile is required starting with iOS 15, iPadOS 15, tvOS 15, and watchOS 8. 
For more on that change, see Using the Latest Code Signature Format.
https://developer.apple.com/documentation/Xcode/using-the-latest-code-signature-format


==================================================è·å–App Store ipa
çˆ±æ€åŠ©æ‰‹

iMazing

Apple Configurator: 
æ‰‹æœºå·²å®‰è£…ä½ç‰ˆæœ¬appæ¡ä»¶ä¸‹
æ›¿æ¢å¼¹çª—æ˜¾ç¤ºæ—¶ä¸æ“ä½œï¼Œè¿›å…¥
/Users/youdun-ndl/Library/Group\ Containers/K36BKF7T3D.group.com.apple.configurator/Library/Caches/Assets/TemporaryItems/MobileApps/ è·å–ipa