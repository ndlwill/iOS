地址解析协议（英语：Address Resolution Protocol，缩写：ARP）是一个通过解析网络层地址来找寻数据链路层地址的网络传输协议

https://tools.ietf.org/html/rfc826
ARP最初在1982年的RFC 826（征求意见稿）[1]中提出并纳入互联网标准STD 37。

ARP是通过网络地址来定位MAC地址。ARP已经在很多网路层和数据链接层之间得以实现

在IPv6中邻居发现协议（NDP）用于代替地址解析协议（ARP）。
https://zh.wikipedia.org/wiki/%E9%82%BB%E5%B1%85%E5%8F%91%E7%8E%B0%E5%8D%8F%E8%AE%AE

在以太网协议中规定，同一局域网中的一台主机要和另一台主机进行直接通信，必须要知道目标主机的MAC地址。
而在TCP/IP协议中，网络层和传输层只关心目标主机的IP地址。
这就导致在以太网中使用IP协议时，数据链路层的以太网协议接到上层IP协议提供的数据中，只包含目的主机的IP地址。
于是需要一种方法，根据目的主机的IP地址，获得其MAC地址。这就是ARP协议要做的事情。所谓地址解析（address resolution）就是主机在发送帧前将目标IP地址转换成目标MAC地址的过程。
另外，当发送主机和目的主机不在同一个局域网中时，即便知道对方的MAC地址，两者也不能直接通信，必须经过路由转发才可以。
所以此时，发送主机通过ARP协议获得的将不是目的主机的真实MAC地址，而是一台可以通往局域网外的路由器的MAC地址。
于是此后发送主机发往目的主机的所有帧，都将发往该路由器，通过它向外发送。这种情况称为委托ARP或ARP代理（ARP Proxy）。

在 以太网（ARP协议只适用于 局域网）中，本地主机想要向某一个IP地址的主机（路由表中的下一跳路由器或者直连的主机）发送数据，但是并不知道其 MAC地址，此时利用ARP协议提供的机制来获取MAC地址，具体过程如下：
1.本地主机 在 局域网 中 广播ARP请求，ARP 请求数据帧 中包含 目的主机 的IP地址。
翻译成 人话 就是：如果你是这个IP地址的拥有者，请回答你的硬件地址。
2.目的主机 的ARP层 解析 这份广播报文，识别出是 询问其硬件地址。于是发送ARP 应答包，里面包含IP地址及其对应的 硬件地址。
翻译一下就是： 你问的IP地址的所有者是我，老子的MAC是xx:xx:xx...
3.本地主机 收到ARP应答后，知道了目的地址的MAC地址，之后的数据报就可以传送了。

格式:
1.目的以太网地址
目的主机 的硬件地址，ARP请求广播包中，因为不知道目的MAC地址，所以 目的地址 全为 1，也就是16进制的FF:FF:FF:FF:FF:FF

2.以太网源地址
源主机的硬件地址。

3.帧类型
对于ARP协议，该字段为0x0806。

4.硬件类型
表示硬件地址的类型。值为 1 时表示以太网地址。也就是说ARP协议不仅仅应用于 以太网协议，还可以支持别的链路层协议。

5.协议类型
表示要映射的协议地址类型,值为0x0800时表示IP协议。

6.硬件地址长度
与硬件类型对应的硬件地址的长度，以字节为单位。如果是 以太网，则是6字节（MAC长度）。

7.协议地址长度
与协议类型对应的协议地址长度，以字节为单位。如果是IP协议，则是 4字节（IP地址长度）。

8.操作类型（op）
四种 操作类型:
ARP请求（1）
ARP应答（2）
RARP请求（3）
RARP应答（4）


9.发送端硬件地址
如果是以太网，则是源主机以太网地址，此处和以太网头中的源地址对应。

10.发送端协议地址
如果是IP协议，则表示 源主机 的IP地址。

11.目的端硬件地址
如果是 以太网，则是目的以太网地址，和以太网头中的目的地址对应。

12.目的端协议地址
如果是IP协议，则表示源主机要请求硬件地址的IP地址。


以太网链路层:
目标以太网地址：目标MAC地址。FF:FF:FF:FF:FF:FF （二进制全1）为广播地址。
源以太网地址：发送方MAC地址。
帧类型：以太类型，ARP为0x0806。

以太网报文数据:
硬件类型：如以太网（0x0001）、分组无线网。
协议类型：如网际协议(IP)（0x0800）、IPv6（0x86DD）。
硬件地址长度：每种硬件地址的字节长度，一般为6（以太网）。
协议地址长度：每种协议地址的字节长度，一般为4（IPv4）。
操作码：1为ARP请求，2为ARP应答，3为RARP请求，4为RARP应答。
源硬件地址：n个字节，n由硬件地址长度得到，一般为发送方MAC地址。
源协议地址：m个字节，m由协议地址长度得到，一般为发送方IP地址。
目标硬件地址：n个字节，n由硬件地址长度得到，一般为目标MAC地址。
目标协议地址：m个字节，m由协议地址长度得到，一般为目标IP地址。


原理:
在每台安装有TCP/IP协议的电脑或路由器里都有一个ARP缓存表，表里的IP地址与MAC地址是一对应的，如下表所示。

主机名称	IP地址	MAC地址
A	192.168.38.10	00-AA-00-62-D2-02
B	192.168.38.11	00-BB-00-62-C2-02
C	192.168.38.12	00-CC-00-62-C2-02
D	192.168.38.13	00-DD-00-62-C2-02
E	192.168.38.14	00-EE-00-62-C2-02
...	...	...

以主机A（192.168.38.10）向主机B（192.168.38.11）发送数据为例。
1.当发送数据时，主机A会在自己的ARP缓存表中寻找是否有目标IP地址。如果找到就知道目标MAC地址为（00-BB-00-62-C2-02），直接把目标MAC地址写入帧里面发送就可。
2.如果在ARP缓存表中没有找到相对应的IP地址，主机A就会在网络上发送一个广播（ARP request），目标MAC地址是“FF.FF.FF.FF.FF.FF”，这表示向同一网段内的所有主机发出这样的询问：“192.168.38.11的MAC地址是什么？”
3.网络上其他主机并不响应ARP询问，只有主机B接收到这个帧时，才向主机A做出这样的回应（ARP response）：“192.168.38.11的MAC地址是00-BB-00-62-C2-02”，此回应以单播方式。这样，主机A就知道主机B的MAC地址，它就可以向主机B发送信息。同时它还更新自己的ARP高速缓存（ARP cache），下次再向主机B发送信息时，直接从ARP缓存表里查找就可。

ARP缓存表采用老化机制，在一段时间内如果表中的某一行没有使用，就会被删除，这样可减少缓存表的长度，加快查询速度。

LAN: 局域网

用抓包神器 wireshark来抓一下ARP包，我们深入理解一下。 
###选择wifi接口，filter填写arp###

如果每次发之前都要广播去 发送ARP请求硬件地址 会不会 太慢，答案是肯定的。
但是协议设计者早就洞察了一切，对于这种问题，我们可以用 万金油 方法解决呀---- 高速缓存。
我们可以在终端键入arp -a获取本机ARP 高速缓存 的所有内容：
有了这些 缓存，我们经常直接使用 硬件地址，加快速度了。


ARP代理：
上面我们讨论都属于一个子网的主机间通信的情况，如果2个主机处于不同的子网，那么ARP又是如何工作的呢？
这种情况下连接这两个主机的 路由器 就可以回答该请求，这个过程称为 委托ARP 或者 ARP代理。
我们知道 IP路由选择，如果主机不相连，我们就把数据报发送到一 默认路由 上，由 路由器 来 转发 该数据报。
在ARP协议中，我们发往网络的请求主机物理地址也会由路由器回答，得到的就是 路由器的物理地址。
发送方就根据这个物理地址把数据报 发送到路由器，由路由器转发，再下面的事情由路由器完成，那是属于IP协议的事了。
当然在那个过程中，也不断使用ARP协议获取每一步的物理地址。

ARP漏洞:
广播
ARP 请求包是已 广播 推送到 以太网，很容易 被抓包

无校验机制
以太网 上的 任何 一台主机，如果接收到一个ARP报文，即使该报文不是 该主机 所发送的ARP 请求 的 应答 报文，该主机也会将ARP报文中的发送者的MAC地址和IP地址更新或加入到ARP高速缓存中。

ARP欺骗:
我们既然能够扫描，那当然也可以用来攻击