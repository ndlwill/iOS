用户态 TCP 栈(lwIP)

App                  你的程序               VPN服务器         网站
 |---- 内层TCP ---->| lwIP |---外层TCP--->|    |----内层TCP---->|

lwIP 负责内层 TCP（App ↔ 网站）这一条连接的全部 TCP 逻辑。
系统 TCP 栈负责外层 TCP（你 ↔ VPN服务器）这一条连接的逻辑。
两者完全互不干涉。




在 iOS 用户态 VPN 场景里，lwIP 和虚拟网卡（TUN）的绑定，本质上是逻辑上的映射，而不是直接操作真实硬件网卡。


TUN 在 iOS 中的角色
TUN 是 内核提供的虚拟网卡驱动
它的功能：
    捕获系统应用发出的 IP 数据包
    提供用户态接口 (NEPacketTunnelProvider.packetFlow.readPackets/writePackets)
    写回数据包给系统应用
对 lwIP 来说，TUN 只是一个 接口，收发数据包的通道。它没有物理存在，也没有硬件作用。